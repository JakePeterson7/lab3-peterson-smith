import static java.util.Arrays.copyOfRange;

class ECBMode {
    static int[] ECB(int[] key, String text, int crypt) {
        int[] plainBin; //Initialize int array
        if(crypt == 0) { //The rest of this is fairly obvious based on the other modes comments
            plainBin = BlockCipher.stringToBinaryArray(text);
        }else{
            plainBin = BlockCipher.binaryStringToBinaryArray(text);
        }
        int[] cipherText = new int[plainBin.length];
        if (crypt == 0) {
            encrypt(key, plainBin, cipherText);
        } else {
            decrypt(key, plainBin, cipherText);
        }
        return cipherText;
    }

    private static void decrypt(int[] keyBin, int[] plainBin, int[] cipherText) {
        //This method processes and decrypts each block of text
        int[] temp; //Initialize int arrays
        int[] tempBin;
        int l = plainBin.length; //Store int of plainBin's length for readability in further functions
        for (int i = 0; i < l / 35; i++) { //Decryption on each block of 35
            tempBin = copyOfRange(plainBin, (i * 35), ((i * 35) + 35)); //Copy ciphertext
            temp = BlockCipher.Decrypt(tempBin, keyBin); //Block decryption
            System.arraycopy(temp, 0, cipherText, (i * 35), temp.length); //Copy decryption result to resulting plaintext
        }
//        if (l % 35 != 0) { //Handle overflow
//            tempBin = copyOfRange(plainBin, (l - l % 35), l);
//            temp = BlockCipher.Decrypt(tempBin, keyBin);
//            System.arraycopy(temp, 0, cipherText, (l - l % 35), temp.length);
//        }
    }

    private static void encrypt(int[] keyBin, int[] plainBin, int[] cipherText) {
        //This method processes and encrypts each block of text, very similar to decrypt
        int[] temp;
        int[] tempBin;
        int l = plainBin.length;
        for (int i = 0; i < l / 35; i++) {
            tempBin = copyOfRange(plainBin, (i * 35), ((i * 35) + 35));
            temp = BlockCipher.Encrypt(tempBin, keyBin);
            System.arraycopy(temp, 0, cipherText, (i * 35), temp.length);
        }
//        if (l % 35 != 0) { //Handle overflow
//            tempBin = copyOfRange(plainBin, (l - l % 35), l);
//            temp = BlockCipher.Encrypt(tempBin, keyBin);
//            System.arraycopy(temp, 0, cipherText, (l - l % 35), temp.length);
//        }
    }

    public static void main(String[] args) { //Test encrypt and decrypt
        String binary = "00001110101000111111001101111100101011000111110111011111101011111001111000000001101110111110101111010110111000110011001110110010101111100111010001101110111001111110111011101001000001001000111111101001100111110100000011111000001111001001111100111101000011010010100110110110100101001010000000100101101101101101101010101100000001001000011011011100100100100001101110010111111010110011111011010000111100000101101101110110010011000111010001111111001111111110111001001110100000010110110101011001010001001110100110011110011101011010000100010100001111110010111110110101100100111010000011111001110101001001100000111100000111100010111110010110000110111011011011011011010100100001000101100011111100001111011001010110001011100001111111111110000010111010011101011100110001011111110111010001110100000110110110111111101001010001010000111111101111101001010110000101110001111110001011100011101110000011010001101100101011111001111000000111100100011111101101010110110000110001001110110010111010101101011001110110001111110111111101001000110011001101110001101101111111010100000011111000110111100011011010111100100111010110111111110111101111010110011101100010011011110111110011110000001101001010110010011110111101001001101010001111110011011111001001010000001101101011110001101010010101100001111000001110010101111100100001000100000011111100010111011001010001001110111110011110011101011011111000001100001111111101111111110111100000110110001111110011111101011010100011110100111011001011101010110000110011101111100111101011110110101100001111010001101111010110011111011100000110100101001101101101010011100000001111001010111001001111100111111000000100011111100100111101101010000000101100000011110000111110011110100001101001010011011011010100100101000001110010101100101011111001010000000000100101101101101101101011110000011111001000111001111011011101100000000110010010110110110101001001100001011100011011001000111110010000100000011011010110010011100000101001001011100000110110110111110001111110011010000111111111101110111011101110011101000010111001111100110100101001110010101100110110110100101010110011101000111111100101101100010010100110011011100110111101111100101010000000010010110110110110101101001010001101100101011001001101010010110000001111000001011100010010100100100000101110111011110011011111001000010001111100101101101101111100010110000010111000001011011011010100100110000101100011111110000111011101111010011101101101101101101101100010000000010101001010011011011111110111110100111010110111110011110110001111000000111100110111110101111011110100000111011011111111001111110110101100100111010110001111111110101001001010000001101101011000100111110010100010011101000111111011111100100111000100001000011111110111111000001010101001110101101111111101111011010000010011101000110111100001111100111101000011010010100110110111101001010010011001100000101101101110110010110010011101000111111011111110101101100001110110010101110011111000011010000001111000111111001101111111010000100010110001111111000111100100101010000111110000100110110111000101010001001110100100011110011110010010100010000100001111111011111100000101101100111010110111111110111101101101001001110100011111101111111010110110000011011000000111101111110111101100001101010000000110110110101001000000001011000111111001011110111010000000010111000001110001001111100111101000000110110001111000011111001011000000000100101101101101101010010000100010110001111111000111011000101001000111110110110110110111101101001000011110101101111011110111110010010000000011011010110010111110111101100000000110000010110110110101001000000001011000111111111101110111010001000000100000001011011010111110100110000101000011111111110111111101111000001010100001111011110111110010010000011111001011011011011010100100001000101110101100110110110110001010000001111100110011111101111011010110010011101000110110001011011011101000001110110001111110011111001001111000001011101110101101101101001010010000010111000001011011011010100100010000101100011111100001111011101001110001001100101011100100111110011101100001101001110111001011100010111100100111010001111110111111101011010010011110100111011001011101101010100100010100001111111100111010000101111001110000011111111001111000001011010001011000111111101111111001010110100001111000001011101001111100101001000000010010110110110111001101010000000000000111111000011110111010001100110101001010111001001111100111010000011110110111111110011111001011000001011100111011001000110000110101101011001011010110001001111100001000000111110000011110010111111101000000001000000111111111101111111010111110011101011100110011011100010100011000101110000010110110110110101000110001000101101101101101101001010000000111001001011110010101111100111001000000100011111111110111011101000001000010000111111101111110000010110010011101000111111001101111100100000000111110010110110110110110101001010001011101111111000100111110010011100000000001111111011101111100101110000000110111011111000111101101111101000010000111111000101110111011100100010111001011011011011111000111001001101000011111100011111000001011000001111101110011011110110010110110100010101000110111101111100100110110100111010011101100001111111101111000001011000111111110011111000110101000011011000000111101111101110100010000100110111000110110111111101001010001010000111111100011110001010010100000001001000110010101111100101010000000010010110110110111000101011001001110100001011100111110000110110100110101001110111101011101010100010000000010010000110110111111101000100001010000111110100011111111010010000010101001110111101011110001101010000100110001101100000111011101000000001001000111111110011101100010110000010111011101110010101100001101000010111110000011110010011111001111010000110100101011110000111110010110000010011001110111111111100001101010001110010001101110010111011101001010001001000001101101101101100010010000010101000110111100011110011101100000011110000010110110110101001000110001011000111111110001110111010100000001101011011011100001111100011011000011010001101100101011111001111000001111101110001101101101010010011100010110001111110010111110110101100000000110000011110010011001011010000000000100000001110100111110011110000001101001010011011011010100100010000011110111011110010011111001001000000111100100011111101101010110100100111011000110111100011111010101100100111010001111110011011111001000110001111100101101101101110010010010000000011000100111001111110101101100000011110000010110110110101001000110001011000111110001011101010010010100000001001010011100001111100001101000000010010110110110110100101001000011010100011101101101101010010010100011111011011011011011101100100111000101010010101111001110101101110111001110100001011100111110011010000100111001010110011011011101100101001100111010110001111001111010101010001001110100100111000111110010010001000101110000011011011011111110100101000101000011111100101111011001000000011000100101011001001111011010100010000100001111111011111100000101100100111010110111111110111101111010010000000100000011111111101101010100010011101000000111000001111100111101000011010010100110110110100101000010000000100101101101101111100010110000011011001110111101111110111101001000100010001101111010111001001010000001010000111111000011110111011101000001100001111111101111110110100011000111110011001111111111000001011111001110101100111110011110111010110000010111011100011100000111101001";
        int[] key = new int[]{1,0,0,1,1,0,1,1,1,0,0,1,0,1,1,1,1,0,0,1,0,1,1,0,0,0,1,1,1,1,0,1,0,0,1};
        //        String result = BlockCipher.BinaryArrayToString(ECB(key, text, 0));
        //        System.out.println(result);
        String result2 = BlockCipher.binaryArrayConvertToASCII(ECB(key, binary, 1));
        System.out.println(result2);

        ECBtest();

    }

    //test for 1-bit error.
    public static void ECBtest(){
        // setup
        System.out.println("\n\n\n start ECB test---------------------------------------------------------");
        String text = "I am happy to join with you today in what will go down in history as the greatest demonstration";
        int[] key = new int[]{1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,1,0,0,1,1,1,0,0,1,1};
        int[] IV = new int[]{0,1,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0};

        //encrpyt
        String result = BlockCipher.binaryArrayConvertToASCII(ECBMode.ECB(key, text, 0));
        //System.out.println(result);
        int[] encrypted = BlockCipher.stringToBinaryArray(result);

        BlockCipher.printIntArray(encrypted);
        System.out.println();
        // 1-bit error: change bit 10 from original.
        int[] original = BlockCipher.stringToBinaryArray(text);
        if(original[3] == 0){
            original[3] = 1;
        } else{
            original[3] = 0;
        }
        String augmentedText = BlockCipher.binaryArrayConvertToASCII(original);

        String newResult = BlockCipher.binaryArrayConvertToASCII(ECBMode.ECB(key, augmentedText, 0));
        //System.out.println(newResult);

        int[] encrypted2 = BlockCipher.stringToBinaryArray(newResult);
        BlockCipher.printIntArray(encrypted2);

    }
}
